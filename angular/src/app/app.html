<nz-layout
  (drop)="onDrop($event)"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  [class.drag-over]="isDragging()"
>
  <app-header
    [title]="title()"
    [(searchTerm)]="attachmentSearchText"
    (addAttachment)="showModal()"
  />
  <div class="tab-navigation">
    <button
      class="tab-button"
      [class.active]="activeTab() === 'files'"
      (click)="switchTab('files')"
    >
      All Files
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab() === 'collections'"
      (click)="switchTab('collections')"
    >
      Collections
    </button>
  </div>
  <nz-content>
    <div class="site-layout-content">
      @if (activeTab() === 'files') {
        <nz-splitter>
          <nz-splitter-panel nzDefaultSize="50%" nzMin="10%" nzMax="90%">
            <app-attachments-list
              [attachments]="filteredAttachments"
              [selectedId]="selectedAttachment()?.id ?? null"
              (selectAttachment)="selectAttachment($event)"
            />
          </nz-splitter-panel>
          <nz-splitter-panel>
            <div class="layout-right">
              <app-attachment-details
                [attachment]="selectedAttachment()"
                [(isEditing)]="isEditingAttachmentDetails"
                (toggleEdit)="toggleEdit()"
                (deleteAttachment)="deleteAttachment(selectedAttachment()!)"
                (openFile)="openFile(selectedAttachment()!)"
                (downloadFile)="downloadFile(selectedAttachment()!)"
              />
            </div>
          </nz-splitter-panel>
        </nz-splitter>
      }
      @if (activeTab() === 'collections') {
        @if (selectedCollection()) {
          <!-- Collection Detail View -->
          <div class="collection-detail-container">
            <div class="collection-header">
              <button class="back-button" (click)="backToCollections()">
                ‚Üê Back
              </button>
              <h2 class="collection-name">{{ selectedCollection()!.name }}</h2>
              <div class="collection-actions">
                <button nz-button (click)="addFilesToCollection()">
                  Add Files
                </button>
                <button nz-button nzDanger (click)="deleteCollection()">
                  Delete Collection
                </button>
              </div>
            </div>
            <div class="collection-content">
              <nz-splitter>
                <nz-splitter-panel nzDefaultSize="50%" nzMin="10%" nzMax="90%">
                  <app-attachments-list
                    [attachments]="filteredAttachments"
                    [selectedId]="selectedAttachment()?.id ?? null"
                    (selectAttachment)="selectAttachment($event)"
                  />
                </nz-splitter-panel>
                <nz-splitter-panel>
                  <div class="layout-right">
                    <app-attachment-details
                      [attachment]="selectedAttachment()"
                      [(isEditing)]="isEditingAttachmentDetails"
                      (toggleEdit)="toggleEdit()"
                      (deleteAttachment)="deleteAttachment(selectedAttachment()!)"
                      (openFile)="openFile(selectedAttachment()!)"
                      (downloadFile)="downloadFile(selectedAttachment()!)"
                    />
                  </div>
                </nz-splitter-panel>
              </nz-splitter>
            </div>
          </div>
        } @else {
          <!-- Collections Grid View -->
          <div class="collections-container">
            <div class="collections-grid">
              <!-- New Collection Button Card -->
              <button class="collection-card new-collection-card" (click)="createNewCollection()">
                <div class="card-content">
                  <div class="card-title">New Collection</div>
                  <div class="plus-icon">+</div>
                </div>
              </button>

              <!-- Collection Cards -->
              @for (collection of collections(); track collection.id) {
                <div class="collection-card" (click)="selectCollection(collection.id)">
                  <div class="card-content">
                    <div class="card-title">{{ collection.name }}</div>
                    <div class="card-count">{{ collection.count }} items</div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      }
    </div>
  </nz-content>

  <div class="drop-overlay" *ngIf="isDragging()">
    <div class="drop-message">
      <span class="drop-icon">üìé</span>
      <span>Drop file to add attachment</span>
    </div>
  </div>
</nz-layout>

<app-add-attachment-modal
  [(visible)]="isAddAttachmentModelVisible"
  [(newAttachmentName)]="newAttachmentName"
  [(newAttachmentFileName)]="newAttachmentFileName"
  [droppedFile]="droppedFile()"
  (cancel)="handleCancel()"
  (submit)="handleSubmit($event)"
/>
